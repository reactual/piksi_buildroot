#!/bin/sh

pid_file=/var/run/dump_syslog.pid

# Close stdin
exec <&-

the_pid=$(cat $pid_file)

# shellcheck disable=SC2039
if [[ -n "$the_pid" ]] && [[ -d "/proc/$the_pid" ]]; then
  kill "$(cat $pid_file)"
fi

nc -w 30 -p 44445 -l -e "/usr/bin/dump_syslog_helper" &

echo $! >$pid_file
